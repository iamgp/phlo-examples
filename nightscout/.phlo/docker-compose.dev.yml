# Development mode override - mounts local phlo source
# Auto-generated by: phlo services start --dev
#
# This file is used automatically when --dev flag is passed.
# It mounts local phlo source into containers for instant iteration.

services:
  dagster-webserver:
    build:
      dockerfile: dagster/Dockerfile.dev
    volumes:
      - ./dagster:/opt/dagster
      - ../workflows:/app/workflows:ro
      - ../transforms:/app/transforms
      - ../tests:/app/tests:ro
      # Mount local phlo source (path set via PHLO_DEV_SOURCE_PATH env var)
      - ${PHLO_DEV_SOURCE_PATH}/src/phlo:/opt/phlo-src/phlo:ro
      - ${PHLO_DEV_SOURCE_PATH}/examples/phlo-plugin-example/src/phlo_example:/opt/phlo-example/phlo_example:ro
    environment:
      PYTHONPATH: /opt/dagster:/app:/opt/phlo-src:/opt/phlo-example

  dagster-daemon:
    build:
      dockerfile: dagster/Dockerfile.dev
    volumes:
      - ./dagster:/opt/dagster
      - ../workflows:/app/workflows:ro
      - ../transforms:/app/transforms
      - ../tests:/app/tests:ro
      # Mount local phlo source
      - ${PHLO_DEV_SOURCE_PATH}/src/phlo:/opt/phlo-src/phlo:ro
      - ${PHLO_DEV_SOURCE_PATH}/examples/phlo-plugin-example/src/phlo_example:/opt/phlo-example/phlo_example:ro
    environment:
      PYTHONPATH: /opt/dagster:/app:/opt/phlo-src:/opt/phlo-example
